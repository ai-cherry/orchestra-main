<div class="p-4 bg-gray-800 rounded-lg shadow-md">
  <h2 class="text-xl font-semibold mb-4 text-white">Agent Teams</h2>
  <button @click="showCreateTeam = true" class="mb-4 px-4 py-2 bg-red-600 rounded hover:bg-red-700 text-white">Create New Team</button>

  <template x-if="showCreateTeam">
    <div class="mb-6 p-4 bg-gray-700 rounded">
      <h3 class="text-lg font-semibold mb-2 text-white">New Team</h3>
      <input type="text" placeholder="Team Name" x-model="newTeamName" class="w-full p-2 rounded mb-2 text-black" />
      <div>
        <label class="block mb-1 text-white">Assign Agents:</label>
        <template x-for="agent in availableAgents" :key="agent.id">
          <div class="flex items-center mb-1">
            <input type="checkbox" :value="agent.id" x-model="selectedAgents" class="mr-2" />
            <span class="text-white" x-text="agent.name"></span>
          </div>
        </template>
      </div>
      <button @click="createTeam()" class="mt-2 px-4 py-2 bg-green-600 rounded hover:bg-green-700 text-white">Save Team</button>
      <button @click="showCreateTeam = false" class="mt-2 ml-2 px-4 py-2 bg-gray-600 rounded hover:bg-gray-700 text-white">Cancel</button>
    </div>
  </template>

  <template x-if="agentTeams.length === 0">
    <p class="text-gray-400">No agent teams created yet.</p>
  </template>

  <template x-for="team in agentTeams" :key="team.id">
    <div class="mb-4 p-4 bg-gray-700 rounded shadow">
      <h3 class="text-lg font-semibold text-white" x-text="team.name"></h3>
      <p class="text-gray-300">Agents: <span x-text="team.agentNames.join(', ')"></span></p>
      <button @click="editTeam(team)" class="mt-2 px-3 py-1 bg-blue-600 rounded hover:bg-blue-700 text-white">Edit</button>
      <button @click="deleteTeam(team.id)" class="mt-2 ml-2 px-3 py-1 bg-red-600 rounded hover:bg-red-700 text-white">Delete</button>
    </div>
  </template>
</div>

<script>
  function agentTeamDashboard() {
    return {
      showCreateTeam: false,
      newTeamName: '',
      selectedAgents: [],
      agentTeams: [],
      availableAgents: [],

      async fetchAgents() {
        // Fetch available agents from backend API
        const res = await fetch('/api/agents');
        this.availableAgents = await res.json();
      },

      async fetchTeams() {
        // Fetch existing teams from backend API
        const res = await fetch('/api/agent-teams');
        this.agentTeams = await res.json();
      },

      async createTeam() {
        if (!this.newTeamName) return alert('Team name is required');
        const payload = {
          name: this.newTeamName,
          agents: this.selectedAgents
        };
        const res = await fetch('/api/agent-teams', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify(payload)
        });
        if (res.ok) {
          this.showCreateTeam = false;
          this.newTeamName = '';
          this.selectedAgents = [];
          await this.fetchTeams();
        } else {
          alert('Failed to create team');
        }
      },

      editTeam(team) {
        // Placeholder for edit functionality
        alert('Edit functionality not implemented yet');
      },

      async deleteTeam(teamId) {
        if (!confirm('Are you sure you want to delete this team?')) return;
        const res = await fetch(`/api/agent-teams/${teamId}`, { method: 'DELETE' });
        if (res.ok) {
          await this.fetchTeams();
        } else {
          alert('Failed to delete team');
        }
      },

      init() {
        this.fetchAgents();
        this.fetchTeams();
      }
    }
  }
</script>
